<div class="card">
  <div class="card-body">
    <h2 class="card-title "><%= @course.title %>
      <button class="btn btn-sm btn-info" data-bs-toggle="collapse" data-bs-target="#demo">Add new lesson </button>
    </h2>
    <p class="card-text"><%= @course.description %></p>
    <!--    added new lesson-->
    <div id="demo" class="collapse">
      <div style="width: 600px;">
        <div class="card m-3">
          <div class="card-body">
            <%= form_with(model: @lesson, url: "/dashboard/add_lesson/#{@course.id}") do |form| %>
              <%#= render partial: "shared/form_errors", locals: { object: form.object } %>
              <div class="mt-4">
                <%= form.label :title %> </br>
                <%= form.text_field :title, style: 'width:100%', placeholder: 'Enter your lesson title', required: true %>
                <% @lesson.errors.full_messages_for(:title).each do |message| %>
                  <div class="text-danger"><%= message %></div>
                <% end %>
              </div>
              <div>
                <%= form.label :description %> <br>
                <%= form.text_area :description, style: 'width:100%;', placeholder: 'Enter lesson content', required: true %>
                <% @lesson.errors.full_messages_for(:description).each do |message| %>
                  <div class="text-danger"><%= message %></div>
                <% end %>
              </div>
              <br>
              <div class="row">
                <div class="col-6">
                  <%= form.submit "Add", class: 'btn btn-primary' %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <!---------------------->
    <br>
    <br>
    <h5>Course content</h5>
    <br>
    <div class="accordion" id="accordionExample">
      <% @course.lessons.each do |lesson| %>
        <div class="accordion-item mb-2">
          <h2 class="accordion-header" id="heading<%= lesson.id %>">
            <div class="row">
              <div class="col-10">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= lesson.id %>" aria-expanded="false" aria-controls="collapse<%= lesson.id %>">
                  <h6><%= lesson.title %></h6>
                </button>
                <!--                add new content -->
                <div id="demo1" class="collapse">
                  <div style="width: 600px;">
                    <div class="card m-3" style="font-size: medium;">
                      <div class="card-body">
                        <%= form_with(model: @content, url: "/dashboard/save_content/#{lesson.id}", multipart: true) do |form| %>
                          <%#= render partial: "shared/form_errors", locals: { object: form.object } %>
                          <div class="mt-4">
                            <%= form.label :title %> </br>
                            <%= form.text_field :title, style: 'width:100%', placeholder: 'Enter your lesson title', required: true %>
                          </div>
                          <br>
                          <div class="full-width-select">
                            <%= form.label :content_type %> </br>
                            <%= form.select :content_type, [["Text", "text"], ["Pdf", "pdf"], ["Image", "image"], ["Video", 'video']], selected: "text", class: 'full-width-select' %>
                          </div>
                          <br>
                          <div id='text_type'>
                            <%= form.label :description %> <br>
                            <%= form.text_area :description, style: 'width:100%;', placeholder: 'Enter lesson content', required: true %>
                          </div>
                          <div id='file_type' style="display: none;">
                            <%= form.label "Upload file" %> <br>
                            <%= file_field_tag :files %>
                          </div>
                          <br>
                          <div class="row">
                            <div class="col-6">
                              <%= form.submit "Add", class: 'btn btn-primary' %>
                            </div>
                          </div>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
                <!-------------------------->
              </div>
              <div class="col-2">
                <button class="btn btn-sm btn-info" data-bs-toggle="collapse" data-bs-target="#demo1">Add new content
                </button>

                <%= link_to 'Edit', "/dashboard/edit_lesson/#{lesson.id}", class: "btn btn-sm btn-success" %>
                <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#myModal<%= lesson.id %>">
                  Delete
                </button>
                <div class="modal" id="myModal<%= lesson.id %>">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h4 class="modal-title">Delete a course</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                      </div>
                      <div class="modal-body" style="font-size: small;">
                        If you delete this lesson, it will automatically delete all of the content. Do you want to
                        delete this?
                      </div>
                      <div class="modal-footer" style="font-size: medium;">
                        <%= form_with url: "/dashboard/delete_lesson/#{lesson.id}", method: :delete do |form| %>
                          <%= form.button "Delete", class: 'btn btn-danger' %>
                        <% end %>
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </h2>
          <div id="collapse<%= lesson.id %>" class="accordion-collapse collapse" aria-labelledby="heading<%= lesson.id %>" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <%= lesson.description %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
<script>
    document.addEventListener('click', function () {
        console.log("hello")
        var contentTypeSelect = document.getElementById('content_type');
        var textTypeDiv = document.getElementById('text_type');
        var fileTypeDiv = document.getElementById('file_type');
        toggleDivVisibility();
        if (textTypeDiv.value === '')
            textTypeDiv.value = 'Enter your descriptions'
        contentTypeSelect.addEventListener('change', toggleDivVisibility);
        function toggleDivVisibility() {
            var selectedValue = contentTypeSelect.value;
            if (selectedValue === 'text') {
                textTypeDiv.style.display = 'block';
                fileTypeDiv.style.display = 'none';
            } else {
                textTypeDiv.style.display = 'none';
                fileTypeDiv.style.display = 'block';
            }
        }
    });
</script>